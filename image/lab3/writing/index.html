<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>A. Writing the Raspberry Pi OS image on the sd-card - Embedded systems</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../css/custom.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "A. Writing the Raspberry Pi OS image on the sd-card";
        var mkdocs_page_input_path = "image/lab3/writing.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../..">
          <img src="../../../img/tux-logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Raspberry Pi OS Labs</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >Lab 1 - Setting-up Raspberry Pi OS Image</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../lab1/intro/">Lab 1 - Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab1/getting/">A. Getting the Raspberry Pi OS image</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab1/mounting/">B. Mounting the Raspberry Pi OS image on the host</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab1/increasing/">C. Increasing size of Raspberry Pi OS image</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab1/modifying/">D. Modifying the Raspberry Pi OS image</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab1/executing/">E. Executing commands on the Raspberry Pi OS image</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Lab 2 - Running the Raspberry Pi OS on a virtual machine on host</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../lab2/intro/">Lab 2 - Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab2/getting/">A. Getting the Raspberry Pi OS image</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab2/installVM/">B. Install QEMU ARM virtual machine (VM)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../lab2/using/">C. Using QEMU Virtual Machine</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Lab 3 - Setting-up and working with the Raspberry Pi OS without graphical user interface</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../intro/">Lab 3 - Introduction</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">A. Writing the Raspberry Pi OS image on the sd-card</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#headless-raspberry-pi">Headless Raspberry Pi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#enable-serial-interface-and-login-shell-over-serial">Enable serial interface and login shell over serial</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#choose-an-imager">Choose an Imager</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#write-the-image">Write the image</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../connecting/">B. Accessing the headless RPI without network</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../setting/">C. Setting up network for ssh access</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../saving/">D. Cloning the image (Optional)</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">QEMU</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../qemu/">Introduction to QEMU</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Embedded systems</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Raspberry Pi OS Labs</li>
          <li class="breadcrumb-item">Lab 3 - Setting-up and working with the Raspberry Pi OS without graphical user interface</li>
      <li class="breadcrumb-item active">A. Writing the Raspberry Pi OS image on the sd-card</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="a-writing-the-raspberry-pi-os-image-on-the-sd-card">A. Writing the Raspberry Pi OS image on the sd-card</h1>
<p>In this part, we plan to write our Raspberry Pi OS image on a sd-card in order to use it on a real board.</p>
<h2 id="headless-raspberry-pi">Headless Raspberry Pi</h2>
<p>For convenience or to save space and money, we don't want to use additional hardware components such as a monitor, keyboard, or mouse to access our Raspberry Pi, especially with a desktopless OS such as our Lite version of Raspberry Pi OS.<br />
We call this screenless setup a headless Raspberry Pi.  </p>
<p>There are different ways to configure a headless Raspberry Pi, here are three :</p>
<ul>
<li><strong>Serial Terminal</strong> - This requires extra hardware in the form of a serial-to-USB adapter, but it is by far the most robust way to connect, as you are not relying on any network setup.</li>
<li><strong>Ethernet with Static IP Address</strong> - This method requires a Linux operating system to change some files on the Raspberry Pi image. You can give the Raspberry Pi a static IP address and then use an Ethernet cable (or WiFi) to log in.</li>
<li><strong>WiFi with DHCP</strong> - You will need to have access to your router to find your Raspberry Pi's IP address in order to log in via SSH. As a result, this may not be the best option in school or office environments.</li>
</ul>
<p>If you would like to access your Raspberry Pi using the least amount of software work or without network, you will need some extra hardware. Two of the pins on the Raspberry Pi offer transmit and receive data for serial communication. With a small change to a file on the boot sector of the SD card, a command line terminal will be broadcast over this serial line, and you can enter commands to control Linux, write programs, etc.</p>
<p>If the other methods do not work to gain access to your Raspberry Pi or you lose your video out signal, using the serial terminal is a great way to see if your Raspberry Pi is still working and to debug any problems you might have.</p>
<p>You will need a USB to serial converter for this to work.</p>
<p><img alt="" src="../../../img/serial-to-usb.png" /></p>
<h2 id="enable-serial-interface-and-login-shell-over-serial">Enable serial interface and login shell over serial</h2>
<p>In versions of the Raspberry Pi after 3 (e.g. 3 Model B, 3 Model B+, Zero W), the processor contains two hardware UARTs. One is dedicated to the Bluetooth module, while the other is a less-featured "mini UART."</p>
<p>The serial interface is not enabled by default on the board, but we have already enabled it in Lab 1.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If Lab 1 made you use <code>raspi-config</code> to enable UART, it may have failed even if your setup was correct.<br />
In fact, <code>raspi-config</code> needs a real Raspberry Pi kernel to work well, and QEMU is not sufficient.<br />
But good news, most things <code>raspi-config</code> does are just file edits, so we can do it safely manually.</p>
</div>
<p>We will make sure the serial interface is enabled :  </p>
<ul>
<li>Mount the image using
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>losetup<span class="w"> </span>-P<span class="w"> </span>/dev/loop50<span class="w"> </span>imgs/2024-11-19-raspios-bookworm-arm64-lite.img
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/loop50p2<span class="w"> </span>/mnt/rpi
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/loop50p1<span class="w"> </span>/mnt/rpi/boot
</code></pre></div></li>
<li>Look for a <code>config.txt</code> file in <code>/boot</code> and open it.</li>
<li>Now check there is the line <code>enable_uart=1</code> under the <code>[all]</code> section, if that's not the case add it, save and exit.</li>
<li>Unmount the image :
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/rpi/boot
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/rpi
sudo<span class="w"> </span>losetup<span class="w"> </span>-d<span class="w"> </span>/dev/loop50
</code></pre></div></li>
</ul>
<p>The sd-card can now be unmounted from your computer.</p>
<h2 id="choose-an-imager">Choose an Imager</h2>
<p>We need to choose an imager and download it.
Raspberry Pi Imager and Balena Etcher are the go-to imagers.</p>
<p><strong>Raspberry Pi Imager</strong> is designed for Raspberry Pi users :</p>
<ul>
<li>Easily pick Raspberry Pi OS or other OSes from the app itself.</li>
<li>Zero-fuss experience built specifically around Pi usage.</li>
<li>Built-in downloads and automatic image selections.</li>
<li>Supports writing local image files</li>
</ul>
<p><strong>Balena Etcher</strong> offers a broad compatibility and reliability :</p>
<ul>
<li>Write any OS image (Ubuntu, Fedora, RetroPie, custom ISOs, etc.)</li>
<li>Verification after writing to reduce corrupted cards</li>
<li>Doesn't offer an OS selection in the app, it needs local image file</li>
</ul>
<p>As we are using a custom image, we will use Balena Etcher which is designed to work with custom images and verifies the write integrity to avoid any corruption.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You could use Raspberry Pi Imager too as it supports writing local image files but it doesn't verify the image after writing.
You would prefer using it when you want an official OS for Raspberry Pi and built-in options.  </p>
</div>
<h2 id="write-the-image">Write the image</h2>
<p><img alt="" src="../../../img/etcher.png" /></p>
<p>Download the software from the official website: <a href="https://etcher.balena.io/">https://etcher.balena.io/</a></p>
<p>Insert the sd-card in your computer.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You might need to use a sd-to-usb adapter if an error occurs when writing the image</p>
</div>
<p>Finally, launch Balena Etcher and follow the the process to write the image on the sd-card.<br />
After a few minutes, the copy should be done and the sd-card ready to be inserted in the Raspberry PI (RPI) board.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../intro/" class="btn btn-neutral float-left" title="Lab 3 - Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../connecting/" class="btn btn-neutral float-right" title="B. Accessing the headless RPI without network">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../intro/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../connecting/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
